//#####################################################################
// Copyright 2011.
// This file is part of PhysBAM whose distribution is governed by the license contained in the accompanying file PHYSBAM_COPYRIGHT.txt.
//#####################################################################
#include <PhysBAM_Tools/Log/LOG.h>
#include <PhysBAM_Solids/PhysBAM_Deformables/Collisions_And_Interactions/TRAPEZOID_INTERSECTION.h>
using namespace PhysBAM;
// Case 1 order: a c b d; ou = c over, b under
template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_1ou(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=(T).5*(b.x-c.x)*(-b.y*b.x-a.y*b.x+a.y*c.x+2*a.x*b.y-b.y*c.x)/(-b.x+a.x);

    dA(1).x=(b.x-c.x)*b.y/(-b.x+a.x)-.5*(b.x-c.x)*(-b.y*b.x-a.y*b.x+a.y*c.x+2*a.x*b.y-b.y*c.x)/sqr(-b.x+a.x);
    dA(1).y=.5*(b.x-c.x)*(c.x-b.x)/(-b.x+a.x);
    dA(2).x=.5*(-b.y*b.x-a.y*b.x+a.y*c.x+2*a.x*b.y-b.y*c.x)/(-b.x+a.x)+.5*(b.x-c.x)*(-b.y-a.y)/(-b.x+a.x)+.5*(b.x-c.x)*(-b.y*b.x-a.y*b.x+a.y*c.x+2*a.x*b.y-b.y*c.x)/sqr(-b.x+a.x);
    dA(2).y=.5*(b.x-c.x)*(-b.x+2*a.x-c.x)/(-b.x+a.x);
    dA(3).x=-.5*(-b.y*b.x-a.y*b.x+a.y*c.x+2*a.x*b.y-b.y*c.x)/(-b.x+a.x)+.5*(b.x-c.x)*(-b.y+a.y)/(-b.x+a.x);
    dA(3).y=0;
    dA(4).x=0;
    dA(4).y=0;


    return A;
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_1oo(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=(T).5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);

    dA(1).x=.5*(-4*c.x*c.x*b.y*c.y*a.x-c.y*a.y*c.x*c.x*c.x+4*c.x*d.y*d.y*b.x*b.x+2*d.y*d.y*b.x*b.x*a.x+4*d.y*b.x*b.x*b.x*c.y+4*c.y*c.y*b.x*b.x*d.x+2*c.y*c.y*b.x*b.x*a.x-2*b.y*b.y*c.x*d.x*d.x+4*b.y*b.y*c.x*c.x*d.x-b.y*c.x*c.x*c.x*d.y+a.y*c.x*c.x*c.x*d.y+2*a.y*b.y*c.x*c.x*c.x-2*c.x*c.x*d.y*d.y*b.x-2*c.y*c.y*d.x*d.x*b.x+c.y*b.y*c.x*c.x*c.x-2*d.y*d.y*b.x*b.x*b.x-2*c.y*c.y*b.x*b.x*b.x-4*d.y*c.y*b.x*b.x*d.x-4*c.x*d.y*d.y*b.x*a.x+b.y*d.x*d.y*b.x*b.x-b.y*c.x*d.y*b.x*b.x-4*d.y*b.x*b.x*c.y*a.x-4*c.y*c.y*b.x*d.x*a.x-4*c.y*c.x*d.y*b.x*b.x-b.y*d.x*c.y*b.x*b.x+b.y*c.x*c.y*b.x*b.x+4*d.y*c.y*b.x*d.x*a.x+4*c.y*c.x*d.y*b.x*a.x-2*c.x*c.x*c.x*b.y*b.y-2*b.y*c.x*c.x*a.y*b.x-2*b.y*d.x*d.x*b.x*a.y+a.y*c.x*b.x*b.x*d.y-a.y*d.x*b.x*b.x*d.y+2*a.y*b.y*d.x*d.x*c.x-4*a.y*b.y*c.x*c.x*d.x-2*a.y*b.x*c.x*c.x*d.y+d.x*c.x*c.x*d.y*b.y-d.x*c.x*c.x*d.y*a.y+2*d.y*b.y*c.x*c.x*b.x+c.y*a.y*c.x*c.x*d.x-c.y*b.y*c.x*c.x*d.x+c.y*a.y*b.x*b.x*d.x+4*c.y*b.y*b.x*d.x*d.x+2*c.y*a.y*c.x*c.x*b.x-c.y*a.y*b.x*b.x*c.x+2*c.y*b.y*c.x*c.x*b.x+4*b.y*d.x*a.y*c.x*b.x+2*a.y*b.x*c.x*d.y*d.x-2*b.y*b.x*d.x*c.x*d.y+4*c.y*b.x*d.x*c.x*d.y-6*c.y*c.x*b.y*d.x*b.x-2*c.y*c.x*a.y*d.x*b.x+2*b.y*b.y*d.x*d.x*a.x+2*c.x*c.x*b.y*b.y*a.x+2*a.x*c.y*c.y*d.x*d.x+8*c.y*c.x*b.y*d.x*a.x-4*a.x*c.y*b.y*d.x*d.x-4*a.x*b.y*b.y*d.x*c.x+2*c.x*c.x*d.y*d.y*a.x-4*c.y*a.x*d.x*c.x*d.y)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/sqr(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-d.y+c.y);
    dA(1).y=.5*(-4*c.x*c.x*c.x*a.y*d.x+c.x*c.x*d.x*d.y*b.x-c.x*c.x*d.x*c.y*b.x+2*c.x*b.y*d.x*d.x*b.x-2*b.x*d.x*d.x*b.y*a.x-2*b.x*c.x*c.x*b.y*a.x-4*a.x*d.x*b.y*c.x*c.x-2*a.x*d.y*c.x*c.x*b.x-a.x*d.y*d.x*c.x*c.x+a.x*c.y*d.x*c.x*c.x-a.x*d.y*d.x*b.x*b.x+a.x*c.y*d.x*b.x*b.x+a.x*d.y*c.x*b.x*b.x-a.x*c.y*c.x*b.x*b.x+2*a.x*c.y*b.x*c.x*c.x+4*b.x*c.x*d.x*b.y*a.x+2*a.x*d.y*c.x*d.x*b.x-2*d.x*a.x*c.y*c.x*b.x+2*b.x*b.x*c.x*c.x*d.y+4*c.x*c.x*c.x*b.y*d.x-c.x*c.x*c.x*d.y*b.x+c.x*c.x*c.x*c.y*b.x-2*c.x*c.x*b.y*d.x*d.x-b.x*b.x*b.x*d.x*c.y+b.x*b.x*b.x*c.x*c.y-2*c.x*c.x*b.x*b.x*c.y+2*a.x*b.y*c.x*c.x*c.x+a.x*d.y*c.x*c.x*c.x-a.x*c.y*c.x*c.x*c.x+2*b.x*b.x*c.x*c.y*d.x-2*c.x*c.x*c.x*c.x*b.y+2*a.y*c.x*c.x*b.x*b.x-4*a.y*c.x*b.x*b.x*d.x-2*b.x*b.x*d.x*c.x*d.y-4*b.y*c.x*c.x*b.x*d.x+8*a.y*c.x*c.x*b.x*d.x+b.x*b.x*b.x*d.x*d.y-c.x*d.y*b.x*b.x*b.x+2*b.y*c.x*c.x*c.x*b.x-4*a.y*c.x*c.x*c.x*b.x-4*a.y*b.x*d.x*d.x*c.x+2*a.y*b.x*b.x*d.x*d.x+2*d.x*d.x*b.y*c.x*a.x+2*c.x*c.x*a.y*d.x*d.x+2*c.x*c.x*c.x*c.x*a.y)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.x-c.x);
    dA(2).x=.5*(2*c.x*c.x*b.y*c.y*a.x+2*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*a.x*a.y-2*a.y*b.x*c.x*c.y*a.x+c.y*a.y*c.x*c.x*c.x-6*c.x*d.y*d.y*b.x*b.x-2*c.x*d.y*d.y*a.x*a.x-6*d.y*d.y*b.x*b.x*a.x+2*d.y*d.y*b.x*a.x*a.x-8*d.y*b.x*b.x*b.x*c.y-6*c.y*c.y*b.x*b.x*d.x-2*c.y*c.y*a.x*a.x*d.x-6*c.y*c.y*b.x*b.x*a.x+2*c.y*c.y*b.x*a.x*a.x+b.y*c.x*c.x*c.x*d.y-a.y*c.x*c.x*c.x*d.y+2*a.y*b.y*c.x*c.x*c.x+2*c.x*c.x*d.y*d.y*b.x+2*c.y*c.y*d.x*d.x*b.x-c.y*b.y*c.x*c.x*c.x+4*d.y*d.y*b.x*b.x*b.x+4*c.y*c.y*b.x*b.x*b.x+6*d.y*c.y*b.x*b.x*d.x+2*d.y*c.y*a.x*a.x*d.x+8*c.x*d.y*d.y*b.x*a.x-3*b.y*d.x*d.y*b.x*b.x+3*b.y*c.x*d.y*b.x*b.x+12*d.y*b.x*b.x*c.y*a.x-4*d.y*b.x*c.y*a.x*a.x+8*c.y*c.y*b.x*d.x*a.x+6*c.y*c.x*d.y*b.x*b.x+2*c.y*c.x*d.y*a.x*a.x+3*b.y*d.x*c.y*b.x*b.x-3*b.y*c.x*c.y*b.x*b.x+2*b.y*d.x*d.y*a.x*b.x-2*b.y*c.x*d.y*a.x*b.x-8*d.y*c.y*b.x*d.x*a.x-2*b.y*d.x*c.y*a.x*b.x+2*b.y*c.x*c.y*a.x*b.x-8*c.y*c.x*d.y*b.x*a.x-2*a.y*a.y*c.x*c.x*c.x-3*a.y*c.x*b.x*b.x*d.y+3*a.y*d.x*b.x*b.x*d.y+2*a.y*b.y*d.x*d.x*c.x-4*a.y*b.y*c.x*c.x*d.x+4*a.y*b.x*c.x*c.x*d.y-d.x*c.x*c.x*d.y*b.y+d.x*c.x*c.x*d.y*a.y-4*d.y*b.y*c.x*c.x*b.x-c.y*a.y*c.x*c.x*d.x+c.y*b.y*c.x*c.x*d.x-3*c.y*a.y*b.x*b.x*d.x-4*c.y*b.y*b.x*d.x*d.x-4*c.y*a.y*c.x*c.x*b.x+3*c.y*a.y*b.x*b.x*c.x-4*a.y*b.x*c.x*d.y*d.x+4*b.y*b.x*d.x*c.x*d.y-4*c.y*b.x*d.x*c.x*d.y+4*c.y*c.x*b.y*d.x*b.x+4*c.y*c.x*a.y*d.x*b.x-2*c.x*a.y*a.y*d.x*d.x+4*c.x*c.x*a.y*a.y*d.x+2*a.y*a.y*d.x*d.x*b.x-2*b.y*d.x*d.x*a.x*a.y-2*a.y*b.x*d.x*d.y*a.x+2*a.y*b.x*c.y*a.x*d.x+2*c.x*c.x*a.y*a.y*b.x-2*a.x*c.y*c.y*d.x*d.x-2*b.y*d.x*c.x*d.y*a.x+2*a.y*c.x*d.y*d.x*a.x+2*a.y*c.x*d.y*b.x*a.x-6*c.y*c.x*b.y*d.x*a.x-2*c.y*c.x*a.y*d.x*a.x+2*b.y*c.x*c.x*d.y*a.x-2*a.y*c.x*c.x*d.y*a.x+4*a.x*c.y*b.y*d.x*d.x-4*c.x*a.y*a.y*b.x*d.x+4*c.x*a.y*a.x*b.y*d.x-2*c.x*c.x*d.y*d.y*a.x+4*c.y*a.x*d.x*c.x*d.y)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/sqr(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.y-c.y);
    dA(2).y=.5*(4*c.x*c.x*c.x*a.y*d.x-c.x*c.x*d.x*d.y*b.x+c.x*c.x*d.x*c.y*b.x-2*a.x*c.x*c.x*b.x*a.y-4*d.x*c.x*b.y*a.x*a.x+8*a.x*d.x*b.y*c.x*c.x-4*a.x*d.x*a.y*c.x*c.x+2*a.x*d.y*c.x*c.x*b.x+4*b.x*c.y*d.x*d.x*a.x+4*d.x*c.y*c.x*a.x*a.x+a.x*d.y*d.x*c.x*c.x-a.x*c.y*d.x*c.x*c.x+a.x*d.y*d.x*b.x*b.x-a.x*c.y*d.x*b.x*b.x-a.x*d.y*c.x*b.x*b.x+a.x*c.y*c.x*b.x*b.x+2*a.x*c.y*b.x*c.x*c.x+4*a.x*c.x*d.x*b.x*a.y-2*a.x*d.y*c.x*d.x*b.x-6*d.x*a.x*c.y*c.x*b.x-2*b.x*b.x*c.x*c.x*d.y-4*c.x*c.x*c.x*b.y*d.x+c.x*c.x*c.x*d.y*b.x-c.x*c.x*c.x*c.y*b.x+2*c.x*c.x*b.y*d.x*d.x+b.x*b.x*b.x*d.x*c.y-b.x*b.x*b.x*c.x*c.y+2*d.x*d.x*b.y*a.x*a.x-4*a.x*b.y*c.x*c.x*c.x+2*a.x*a.y*c.x*c.x*c.x+2*a.x*a.x*c.x*c.x*b.y-2*c.y*d.x*d.x*a.x*a.x-a.x*d.y*c.x*c.x*c.x+a.x*c.y*c.x*c.x*c.x-2*c.y*a.x*a.x*c.x*c.x-2*d.x*d.x*b.x*b.x*c.y+2*b.x*b.x*c.x*c.y*d.x+2*c.x*c.x*c.x*c.x*b.y+2*b.x*b.x*d.x*c.x*d.y-4*a.y*c.x*c.x*b.x*d.x-b.x*b.x*b.x*d.x*d.y+c.x*d.y*b.x*b.x*b.x+2*a.y*c.x*c.x*c.x*b.x+2*a.y*b.x*d.x*d.x*c.x-4*d.x*d.x*b.y*c.x*a.x+2*d.x*d.x*a.y*c.x*a.x-2*a.y*b.x*d.x*d.x*a.x-2*c.x*c.x*a.y*d.x*d.x-2*c.x*c.x*c.x*c.x*a.y)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);
    dA(3).x=.5*(3*c.x*c.x*b.y*c.y*a.x-3*c.x*c.x*a.y*c.y*a.x+6*c.x*c.x*b.y*a.x*a.y-4*a.y*b.x*a.x*b.y*c.x+4*a.y*b.x*c.x*c.y*a.x+2*a.y*a.y*b.x*b.x*c.x+2*a.x*a.x*b.y*b.y*c.x+2*c.x*d.y*d.y*b.x*b.x+2*c.x*d.y*d.y*a.x*a.x+4*d.y*d.y*b.x*b.x*a.x-2*d.y*d.y*b.x*a.x*a.x+2*d.y*b.x*b.x*b.x*c.y+2*b.y*b.y*c.x*d.x*d.x-6*b.y*b.y*c.x*c.x*d.x-8*a.y*b.y*c.x*c.x*c.x-2*d.y*d.y*b.x*b.x*b.x-2*d.y*c.y*b.x*b.x*d.x-2*d.y*c.y*a.x*a.x*d.x-4*c.x*d.y*d.y*b.x*a.x+2*b.y*d.x*d.y*b.x*b.x-4*b.y*c.x*d.y*b.x*b.x-4*d.y*b.x*b.x*c.y*a.x+2*d.y*b.x*c.y*a.x*a.x+4*b.y*d.x*c.y*a.x*a.x-4*b.y*c.x*c.y*a.x*a.x+2*b.y*d.x*c.y*b.x*b.x-2*b.y*d.x*d.y*a.x*b.x+4*b.y*c.x*d.y*a.x*b.x+4*d.y*c.y*b.x*d.x*a.x-6*b.y*d.x*c.y*a.x*b.x+4*b.y*c.x*c.y*a.x*b.x+4*c.x*c.x*c.x*b.y*b.y+4*a.y*a.y*c.x*c.x*c.x+6*b.y*c.x*c.x*a.y*b.x+2*b.y*d.x*d.x*b.x*a.y+4*a.y*c.x*b.x*b.x*d.y-2*a.y*d.x*b.x*b.x*d.y-4*a.y*b.y*d.x*d.x*c.x+12*a.y*b.y*c.x*c.x*d.x-3*a.y*b.x*c.x*c.x*d.y+3*d.y*b.y*c.x*c.x*b.x+2*c.y*a.y*b.x*b.x*d.x+3*c.y*a.y*c.x*c.x*b.x-4*c.y*a.y*b.x*b.x*c.x-3*c.y*b.y*c.x*c.x*b.x-8*b.y*d.x*a.y*c.x*b.x+2*a.y*b.x*c.x*d.y*d.x-2*b.y*b.x*d.x*c.x*d.y+2*c.y*c.x*b.y*d.x*b.x-2*c.y*c.x*a.y*d.x*b.x+2*c.x*a.y*a.y*d.x*d.x-6*c.x*c.x*a.y*a.y*d.x-2*a.y*a.y*b.x*b.x*d.x-2*a.x*a.x*b.y*b.y*d.x+b.x*b.x*b.x*b.y*d.y-b.x*b.x*b.x*b.y*c.y-b.x*b.x*b.x*a.y*d.y+b.x*b.x*b.x*a.y*c.y-2*b.y*b.y*d.x*d.x*a.x-2*a.y*a.y*d.x*d.x*b.x-b.x*b.x*b.y*d.y*a.x+b.x*b.x*b.y*c.y*a.x+b.x*b.x*a.y*d.y*a.x-b.x*b.x*a.y*c.y*a.x+2*b.y*d.x*d.x*a.x*a.y+4*a.y*b.x*d.x*a.x*b.y+2*a.y*b.x*d.x*d.y*a.x-2*a.y*b.x*c.y*a.x*d.x-6*c.x*c.x*b.y*b.y*a.x-6*c.x*c.x*a.y*a.y*b.x+2*b.y*d.x*c.x*d.y*a.x-2*a.y*c.x*d.y*d.x*a.x-4*a.y*c.x*d.y*b.x*a.x-2*c.y*c.x*b.y*d.x*a.x+2*c.y*c.x*a.y*d.x*a.x-3*b.y*c.x*c.x*d.y*a.x+3*a.y*c.x*c.x*d.y*a.x+8*a.x*b.y*b.y*d.x*c.x+8*c.x*a.y*a.y*b.x*d.x-8*c.x*a.y*a.x*b.y*d.x)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/sqr(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.y-a.y);
    dA(3).y=.5*(2*a.x*c.x*c.x*b.x*a.y+4*b.x*d.x*d.x*b.y*a.x+4*d.x*c.x*b.y*a.x*a.x+2*b.x*c.x*c.x*b.y*a.x-a.x*d.x*b.y*c.x*c.x+a.x*d.x*a.y*c.x*c.x-a.x*d.x*b.y*b.x*b.x+a.x*c.x*b.y*b.x*b.x+a.x*d.x*a.y*b.x*b.x-a.x*c.x*a.y*b.x*b.x-4*b.x*c.y*d.x*d.x*a.x-4*a.x*d.y*d.x*b.x*b.x+8*a.x*c.y*d.x*b.x*b.x-4*a.x*d.y*c.x*b.x*b.x-2*a.x*c.x*d.x*b.x*a.y-6*b.x*c.x*d.x*b.y*a.x+4*a.x*d.y*c.x*d.x*b.x-4*b.x*b.x*b.x*d.x*c.y-2*d.x*d.x*b.y*a.x*a.x+a.x*b.y*c.x*c.x*c.x-a.x*a.y*c.x*c.x*c.x-2*a.x*a.x*c.x*c.x*b.y+2*c.y*d.x*d.x*a.x*a.x+2*d.x*d.x*b.x*b.x*c.y+2*b.x*b.x*b.x*b.x*c.y-2*b.y*b.x*b.x*d.x*d.x-2*a.y*c.x*c.x*b.x*b.x+b.x*b.x*b.x*b.y*d.x-b.x*b.x*b.x*b.y*c.x-b.x*b.x*b.x*a.y*d.x-2*d.y*b.x*b.x*b.x*b.x+2*a.y*c.x*b.x*b.x*d.x+2*b.y*c.x*b.x*b.x*d.x-2*b.x*b.x*d.x*c.x*d.y+b.y*c.x*c.x*b.x*d.x-a.y*c.x*c.x*b.x*d.x+b.x*b.x*b.x*a.y*c.x+2*b.x*b.x*b.x*d.x*d.y+2*c.x*d.y*b.x*b.x*b.x-b.y*c.x*c.x*c.x*b.x+a.y*c.x*c.x*c.x*b.x-4*b.x*b.x*b.x*c.y*a.x+2*b.x*b.x*a.x*a.x*c.y+4*b.x*b.x*b.x*d.y*a.x-2*b.x*b.x*d.y*a.x*a.x-4*c.y*b.x*d.x*a.x*a.x-2*a.x*a.x*d.x*c.x*d.y+2*b.x*c.x*a.x*a.x*d.y+2*b.x*d.x*a.x*a.x*d.y)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);
    dA(4).x=.5*(-c.x*c.x*b.y*c.y*a.x+c.x*c.x*a.y*c.y*a.x-4*c.x*c.x*b.y*a.x*a.y+4*a.y*b.x*a.x*b.y*c.x-2*a.y*b.x*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*c.x-2*a.x*a.x*b.y*b.y*c.x+2*d.y*b.x*b.x*b.x*c.y+2*c.y*c.y*b.x*b.x*d.x+2*c.y*c.y*a.x*a.x*d.x+4*c.y*c.y*b.x*b.x*a.x-2*c.y*c.y*b.x*a.x*a.x+2*b.y*b.y*c.x*c.x*d.x+4*a.y*b.y*c.x*c.x*c.x-2*c.y*c.y*b.x*b.x*b.x+2*b.y*c.x*d.y*b.x*b.x-4*d.y*b.x*b.x*c.y*a.x+2*d.y*b.x*c.y*a.x*a.x-4*b.y*d.x*c.y*a.x*a.x+4*b.y*c.x*c.y*a.x*a.x-4*c.y*c.y*b.x*d.x*a.x-2*c.y*c.x*d.y*b.x*b.x-2*c.y*c.x*d.y*a.x*a.x-4*b.y*d.x*c.y*b.x*b.x+2*b.y*c.x*c.y*b.x*b.x-2*b.y*c.x*d.y*a.x*b.x+8*b.y*d.x*c.y*a.x*b.x-6*b.y*c.x*c.y*a.x*b.x+4*c.y*c.x*d.y*b.x*a.x-2*c.x*c.x*c.x*b.y*b.y-2*a.y*a.y*c.x*c.x*c.x-4*b.y*c.x*c.x*a.y*b.x-2*a.y*c.x*b.x*b.x*d.y-4*a.y*b.y*c.x*c.x*d.x+a.y*b.x*c.x*c.x*d.y-d.y*b.y*c.x*c.x*b.x-c.y*a.y*c.x*c.x*b.x+2*c.y*a.y*b.x*b.x*c.x+c.y*b.y*c.x*c.x*b.x+4*b.y*d.x*a.y*c.x*b.x+2*c.x*c.x*a.y*a.y*d.x+2*a.y*a.y*b.x*b.x*d.x+2*a.x*a.x*b.y*b.y*d.x-b.x*b.x*b.x*b.y*d.y+b.x*b.x*b.x*b.y*c.y+b.x*b.x*b.x*a.y*d.y-b.x*b.x*b.x*a.y*c.y+b.x*b.x*b.y*d.y*a.x-b.x*b.x*b.y*c.y*a.x-b.x*b.x*a.y*d.y*a.x+b.x*b.x*a.y*c.y*a.x-4*a.y*b.x*d.x*a.x*b.y+4*c.x*c.x*b.y*b.y*a.x+4*c.x*c.x*a.y*a.y*b.x+2*a.y*c.x*d.y*b.x*a.x+b.y*c.x*c.x*d.y*a.x-a.y*c.x*c.x*d.y*a.x-4*a.x*b.y*b.y*d.x*c.x-4*c.x*a.y*a.y*b.x*d.x+4*c.x*a.y*a.x*b.y*d.x)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/sqr(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-b.y+a.y);
    dA(4).y=.5*(-2*a.x*c.x*c.x*b.x*a.y+2*b.x*c.x*c.x*b.y*a.x+a.x*d.x*b.y*c.x*c.x-a.x*d.x*a.y*c.x*c.x+a.x*d.x*b.y*b.x*b.x-a.x*c.x*b.y*b.x*b.x-a.x*d.x*a.y*b.x*b.x+a.x*c.x*a.y*b.x*b.x-4*a.x*d.y*c.x*c.x*b.x-2*d.x*c.y*c.x*a.x*a.x-4*a.x*c.y*d.x*b.x*b.x+8*a.x*d.y*c.x*b.x*b.x-4*a.x*c.y*c.x*b.x*b.x+2*c.y*b.x*c.x*a.x*a.x+2*a.x*c.x*d.x*b.x*a.y-2*b.x*c.x*d.x*b.y*a.x+4*d.x*a.x*c.y*c.x*b.x+2*b.x*b.x*c.x*c.x*d.y+2*b.x*b.x*b.x*d.x*c.y+2*b.x*b.x*b.x*c.x*c.y-a.x*b.y*c.x*c.x*c.x+a.x*a.y*c.x*c.x*c.x-2*b.x*b.x*c.x*c.x*b.y-2*b.x*b.x*c.x*c.y*d.x-2*b.x*b.x*b.x*b.x*c.y+2*a.y*c.x*c.x*b.x*b.x-b.x*b.x*b.x*b.y*d.x+b.x*b.x*b.x*b.y*c.x+b.x*b.x*b.x*a.y*d.x+2*d.y*b.x*b.x*b.x*b.x-2*a.y*c.x*b.x*b.x*d.x+2*b.y*c.x*b.x*b.x*d.x-b.y*c.x*c.x*b.x*d.x+a.y*c.x*c.x*b.x*d.x-b.x*b.x*b.x*a.y*c.x-4*c.x*d.y*b.x*b.x*b.x+b.y*c.x*c.x*c.x*b.x-a.y*c.x*c.x*c.x*b.x+4*b.x*b.x*b.x*c.y*a.x-2*b.x*b.x*a.x*a.x*c.y-4*b.x*b.x*b.x*d.y*a.x+2*b.x*b.x*d.y*a.x*a.x+2*c.y*b.x*d.x*a.x*a.x+2*c.x*c.x*d.y*a.x*a.x-4*b.x*c.x*a.x*a.x*d.y)/(-d.x+c.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-2*a.y*b.x*d.x*d.x*a.x*b.y-2*a.y*b.x*b.x*d.x*c.x*d.y-2*a.y*b.x*c.x*c.x*a.x*b.y+2*a.y*b.x*b.x*c.x*c.y*d.x-2*a.y*b.x*c.x*c.x*d.y*a.x+4*a.x*b.y*d.x*d.x*c.y*b.x+4*a.x*a.x*b.y*c.x*c.y*d.x+2*a.x*b.y*c.x*c.x*d.y*b.x-2*c.y*b.x*b.x*d.x*c.x*d.y-2*c.y*a.x*a.x*d.x*c.x*d.y-c.x*c.x*b.y*d.x*d.y*b.x+c.x*c.x*b.y*d.x*d.y*a.x+c.x*c.x*b.y*d.x*c.y*b.x-c.x*c.x*b.y*d.x*c.y*a.x+c.x*c.x*a.y*d.x*d.y*b.x-c.x*c.x*a.y*d.x*d.y*a.x-c.x*c.x*a.y*d.x*c.y*b.x+c.x*c.x*a.y*d.x*c.y*a.x+b.x*b.x*b.y*d.x*d.y*a.x-b.x*b.x*b.y*d.x*c.y*a.x-b.x*b.x*b.y*c.x*d.y*a.x+b.x*b.x*b.y*c.x*c.y*a.x-b.x*b.x*a.y*d.x*d.y*a.x+b.x*b.x*a.y*d.x*c.y*a.x+b.x*b.x*a.y*c.x*d.y*a.x-b.x*b.x*a.y*c.x*c.y*a.x-2*a.y*a.y*b.x*b.x*d.x*c.x+2*a.y*b.x*b.x*c.x*c.x*d.y-2*a.x*a.x*b.y*b.y*d.x*c.x-2*a.x*a.x*b.y*d.x*d.x*c.y-2*c.y*c.y*b.x*d.x*d.x*a.x-2*c.x*c.x*d.y*d.y*b.x*a.x+4*c.x*c.x*c.x*b.y*d.x*a.y+c.x*c.x*c.x*b.y*d.y*b.x-c.x*c.x*c.x*b.y*d.y*a.x-c.x*c.x*c.x*b.y*c.y*b.x+c.x*c.x*c.x*b.y*c.y*a.x-c.x*c.x*c.x*a.y*d.y*b.x+c.x*c.x*c.x*a.y*d.y*a.x+c.x*c.x*c.x*a.y*c.y*b.x-c.x*c.x*c.x*a.y*c.y*a.x-2*c.x*c.x*b.y*d.x*d.x*a.y+c.x*c.x*c.x*c.x*b.y*b.y+c.x*c.x*c.x*c.x*a.y*a.y+b.x*b.x*b.x*b.x*d.y*d.y+b.x*b.x*b.x*b.x*c.y*c.y-2*c.x*d.y*d.y*b.x*b.x*b.x+a.y*a.y*b.x*b.x*d.x*d.x+a.y*a.y*b.x*b.x*c.x*c.x+a.x*a.x*b.y*b.y*d.x*d.x+a.x*a.x*b.y*b.y*c.x*c.x+c.y*c.y*b.x*b.x*d.x*d.x+c.y*c.y*a.x*a.x*d.x*d.x+c.x*c.x*d.y*d.y*b.x*b.x+c.x*c.x*d.y*d.y*a.x*a.x+c.x*c.x*b.y*b.y*d.x*d.x+c.x*c.x*a.y*a.y*d.x*d.x-2*c.x*c.x*c.x*b.y*b.y*d.x-2*c.x*c.x*c.x*c.x*b.y*a.y-2*c.x*c.x*c.x*a.y*a.y*d.x+b.x*b.x*d.y*d.y*a.x*a.x+b.x*b.x*c.y*c.y*a.x*a.x-2*b.x*b.x*b.x*d.y*d.y*a.x-2*b.x*b.x*b.x*b.x*d.y*c.y-2*b.x*b.x*b.x*c.y*c.y*a.x-2*b.y*b.y*c.x*c.x*c.x*a.x-2*a.y*a.y*c.x*c.x*c.x*b.x-2*c.y*c.y*b.x*b.x*b.x*d.x-b.x*b.x*b.x*b.y*d.x*d.y+b.x*b.x*b.x*b.y*d.x*c.y+b.x*b.x*b.x*b.y*c.x*d.y-b.x*b.x*b.x*b.y*c.x*c.y+b.x*b.x*b.x*a.y*d.x*d.y-b.x*b.x*b.x*a.y*d.x*c.y-b.x*b.x*b.x*a.y*c.x*d.y+b.x*b.x*b.x*a.y*c.x*c.y+4*b.x*b.x*b.x*d.y*c.y*a.x-2*b.x*b.x*d.y*a.x*a.x*c.y-2*c.x*b.y*b.y*d.x*d.x*a.x+4*c.x*c.x*b.y*b.y*d.x*a.x+2*b.y*c.x*c.x*c.x*b.x*a.y-2*b.y*c.x*c.x*b.x*b.x*d.y+2*b.y*c.x*c.x*c.x*a.x*a.y-2*b.y*c.x*c.x*a.x*a.x*c.y-2*c.x*a.y*a.y*d.x*d.x*b.x+4*c.x*c.x*a.y*a.y*d.x*b.x-2*a.y*c.x*c.x*b.x*b.x*c.y+2*c.y*b.x*b.x*b.x*c.x*d.y-2*c.y*b.x*b.x*d.x*d.x*b.y+2*c.y*b.x*b.x*b.x*d.x*d.y+4*c.y*c.y*b.x*b.x*d.x*a.x-2*c.y*c.y*b.x*d.x*a.x*a.x+2*c.x*b.y*d.x*d.x*b.x*a.y-4*c.x*c.x*b.y*d.x*b.x*a.y+2*c.x*b.y*d.x*b.x*b.x*d.y+2*c.x*b.y*d.x*b.x*b.x*c.y+2*c.x*b.y*d.x*d.x*a.x*a.y-4*c.x*c.x*b.y*d.x*a.x*a.y+2*b.y*c.x*c.x*b.x*c.y*a.x+2*a.y*c.x*c.x*b.x*c.y*a.x-4*c.y*b.x*b.x*c.x*d.y*a.x+2*c.y*b.x*c.x*a.x*a.x*d.y-4*c.y*b.x*b.x*d.x*d.y*a.x+2*c.y*b.x*d.x*a.x*a.x*d.y+4*c.x*d.y*d.y*b.x*b.x*a.x-2*c.x*d.y*d.y*b.x*a.x*a.x+4*a.y*b.x*d.x*a.x*b.y*c.x+2*a.y*b.x*d.x*c.x*d.y*a.x-2*a.y*b.x*c.x*c.y*a.x*d.x-2*a.x*b.y*d.x*c.x*d.y*b.x-6*a.x*b.y*c.x*c.y*b.x*d.x+4*c.y*b.x*d.x*c.x*d.y*a.x)/(-d.x+c.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.x-a.x);

    return A;
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_1uu(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=(T).5*(a.y*c.x*c.x*d.y+c.y*a.y*c.x*c.x-c.y*b.y*c.x*c.x-b.y*c.x*c.x*d.y+c.y*c.y*b.x*c.x-2*c.y*c.x*a.y*d.x-c.y*c.y*a.x*c.x-2*a.y*c.x*d.y*b.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x+2*c.y*c.x*b.y*d.x+b.x*b.y*b.y*c.x+a.x*b.y*b.y*d.x+b.y*b.x*b.x*d.y+a.y*b.x*b.x*d.y-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x+c.y*c.y*a.x*d.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);

    dA(1).x=.5*(-c.y*c.y*c.x+2*b.y*c.x*d.y-b.y*b.y*c.x+b.y*b.y*d.x-2*b.y*d.x*c.y-2*b.y*d.y*b.x+c.y*c.y*d.x+2*b.y*c.y*b.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-d.y+c.y);
    dA(1).y=.5*(c.y*c.x*c.x-2*c.x*d.y*b.x-2*c.y*c.x*d.x+d.y*c.x*c.x+d.y*b.x*b.x-c.y*b.x*b.x+2*c.y*b.x*d.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.x-c.x);
    dA(2).x=.5*(-2*a.y*c.x*d.y+c.y*c.y*c.x+b.y*b.y*c.x+2*b.y*d.y*b.x-2*b.y*d.y*a.x-2*a.y*c.y*b.x-2*b.y*c.y*b.x+2*a.y*d.y*b.x+2*b.y*c.y*a.x-b.y*b.y*d.x-c.y*c.y*d.x+2*c.y*a.y*d.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.y-c.y);
    dA(2).y=.5*(-c.y*c.x*c.x-d.y*c.x*c.x+2*c.y*c.x*d.x+2*c.x*d.y*a.x-2*a.x*b.y*c.x+2*b.x*b.y*c.x+d.y*b.x*b.x+2*a.x*b.y*d.x-2*c.y*a.x*d.x-2*b.x*d.y*a.x-c.y*b.x*b.x+2*b.x*c.y*a.x-2*b.x*b.y*d.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-d.x+c.x);
    dA(3).x=.5*(2*a.y*c.x*d.y-2*b.y*c.x*c.y+2*c.y*a.y*c.x-2*b.y*c.x*d.y-a.x*c.y*c.y+2*b.y*d.x*c.y-2*a.y*d.y*b.x+c.y*c.y*b.x+2*b.y*d.y*a.x-b.y*b.y*a.x-2*c.y*a.y*d.x+b.y*b.y*b.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.y-a.y);
    dA(3).y=.5*(-b.y*c.x*c.x+a.y*c.x*c.x-2*c.y*a.x*c.x+2*c.x*b.y*d.x+2*c.y*b.x*c.x-2*c.x*a.y*d.x-2*a.x*b.y*d.x-a.y*b.x*b.x-b.y*b.x*b.x+2*c.y*a.x*d.x+2*a.x*b.y*b.x-2*c.y*b.x*d.x+2*a.y*b.x*d.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-b.x+a.x);
    dA(4).x=.5*(2*b.y*c.x*c.y-2*c.y*a.y*c.x+b.y*b.y*a.x-2*b.y*c.y*a.x+a.x*c.y*c.y-b.y*b.y*b.x-c.y*c.y*b.x+2*a.y*c.y*b.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-b.y+a.y);
    dA(4).y=.5*(a.y*c.x*c.x-b.y*c.x*c.x-2*a.y*b.x*c.x+2*a.x*b.y*c.x+b.y*b.x*b.x-2*a.x*b.y*b.x+a.y*b.x*b.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(a.y*c.x*c.x*d.y-c.y*b.y*c.x*c.x+c.y*a.y*c.x*c.x-b.y*c.x*c.x*d.y-c.y*c.y*a.x*c.x+2*c.y*c.x*b.y*d.x-2*a.y*c.x*d.y*b.x+c.y*c.y*b.x*c.x+2*b.y*c.x*d.y*a.x-a.x*b.y*b.y*c.x-2*c.y*c.x*a.y*d.x+b.x*b.y*b.y*c.x+b.y*b.x*b.x*d.y+a.x*b.y*b.y*d.x-2*b.y*d.x*c.y*a.x-2*a.x*b.y*d.y*b.x-a.y*b.x*b.x*c.y-c.y*b.x*b.x*b.y+c.y*c.y*a.x*d.x+a.y*b.x*b.x*d.y+2*b.y*b.x*c.y*a.x-b.x*b.y*b.y*d.x-c.y*c.y*b.x*d.x+2*a.y*d.x*c.y*b.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.x-a.x);

    return A;
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_1uo(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=(T).5*(b.x-c.x)*(-d.y*b.x+c.y*b.x-2*c.y*d.x+c.x*d.y+c.y*c.x)/(-d.x+c.x);

    dA(1).x=0;
    dA(1).y=0;
    dA(2).x=.5*(-d.y*b.x+c.y*b.x-2*c.y*d.x+c.x*d.y+c.y*c.x)/(-d.x+c.x)+.5*(b.x-c.x)*(-d.y+c.y)/(-d.x+c.x);
    dA(2).y=0;
    dA(3).x=-.5*(-d.y*b.x+c.y*b.x-2*c.y*d.x+c.x*d.y+c.y*c.x)/(-d.x+c.x)+.5*(b.x-c.x)*(c.y+d.y)/(-d.x+c.x)-.5*(b.x-c.x)*(-d.y*b.x+c.y*b.x-2*c.y*d.x+c.x*d.y+c.y*c.x)/sqr(-d.x+c.x);
    dA(3).y=.5*(b.x-c.x)*(b.x-2*d.x+c.x)/(-d.x+c.x);
    dA(4).x=-(b.x-c.x)*c.y/(-d.x+c.x)+.5*(b.x-c.x)*(-d.y*b.x+c.y*b.x-2*c.y*d.x+c.x*d.y+c.y*c.x)/sqr(-d.x+c.x);
    dA(4).y=.5*(b.x-c.x)*(c.x-b.x)/(-d.x+c.x);
    return A;
}

// Case 2 order: a c d b; ou = c over, d under
template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_2ou(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=(T).5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*c.y*b.x*b.x+2*b.y*b.x*c.y*a.x+2*a.y*b.x*b.y*c.x+2*a.y*b.x*c.y*a.x+2*a.y*a.x*b.y*c.x-2*a.y*a.y*b.x*c.x-2*b.y*a.x*a.x*c.y-2*a.y*b.x*a.x*b.y+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);

    dA(1).x=.5*(-d.x+c.x)*(b.y*d.x*d.y+b.y*d.x*c.y-b.y*c.x*d.y+b.y*c.x*c.y-a.y*d.x*d.y-c.y*a.y*d.x+a.y*c.x*d.y-c.y*a.y*c.x+2*a.x*d.y*d.y-2*b.x*d.y*d.y-2*b.y*b.y*c.x+2*a.y*b.y*c.x+2*b.y*b.y*a.x-4*b.y*c.y*a.x-2*b.y*b.x*a.y+2*b.y*c.y*b.x+2*a.y*c.y*b.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/sqr(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-d.y+c.y);
    dA(1).y=.5*(-d.x+c.x)*(d.x*d.y*b.x-d.x*d.y*a.x+c.y*b.x*d.x-c.y*a.x*d.x-c.x*d.y*b.x+c.x*d.y*a.x+c.y*b.x*c.x-c.y*a.x*c.x+2*a.y*c.x*c.x-2*b.y*c.x*c.x-4*a.y*b.x*c.x+2*b.x*b.y*c.x+2*a.x*b.y*c.x+2*a.y*b.x*b.x-2*c.y*b.x*b.x-2*a.x*b.y*b.x+2*b.x*c.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.x-c.x);
    dA(2).x=.5*(-d.x+c.x)*(-b.y*d.x*d.y-b.y*d.x*c.y+b.y*c.x*d.y-b.y*c.x*c.y+a.y*d.x*d.y+c.y*a.y*d.x-a.y*c.x*d.y+c.y*a.y*c.x+2*b.x*d.y*d.y-2*a.x*d.y*d.y-2*c.x*a.y*a.y+2*a.y*b.y*c.x+2*a.y*a.y*b.x-4*a.y*c.y*b.x-2*b.y*a.x*a.y+2*b.y*c.y*a.x+2*a.y*c.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/sqr(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.y-c.y);
    dA(2).y=.5*(-d.x+c.x)*(-d.x*d.y*b.x+d.x*d.y*a.x-c.y*b.x*d.x+c.y*a.x*d.x+c.x*d.y*b.x-c.x*d.y*a.x-c.y*b.x*c.x+c.y*a.x*c.x+2*b.y*c.x*c.x-2*a.y*c.x*c.x-4*a.x*b.y*c.x+2*a.y*b.x*c.x+2*a.y*a.x*c.x+2*a.x*a.x*b.y-2*c.y*a.x*a.x-2*a.y*a.x*b.x+2*b.x*c.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*sqr(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);
    dA(3).x=.5*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(b.y*d.y*b.x-b.y*d.y*a.x-b.y*c.y*b.x+b.y*c.y*a.x-a.y*d.y*b.x+a.y*d.y*a.x+a.y*c.y*b.x-a.y*c.y*a.x+2*b.y*b.y*c.x+2*c.x*a.y*a.y-4*a.y*b.y*c.x-2*b.y*b.y*a.x-2*a.y*a.y*b.x+2*b.y*b.x*a.y+2*b.y*a.x*a.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.y-a.y);
    dA(3).y=.5*(-d.x+c.x)*(-b.x*b.y*d.x+a.x*b.y*d.x-b.x*b.y*c.x+a.x*b.y*c.x+a.y*b.x*d.x-a.y*a.x*d.x+a.y*b.x*c.x-a.y*a.x*c.x-2*a.y*b.x*b.x+2*a.y*a.x*b.x+2*a.x*b.y*b.x-2*a.x*a.x*b.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);
    dA(4).x=-.5*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(b.y*c.y*a.x-b.y*d.y*b.x+b.y*d.y*a.x-b.y*c.y*b.x-a.y*c.y*a.x+a.y*d.y*b.x-a.y*d.y*a.x+a.y*c.y*b.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-b.y+a.y);
    dA(4).y=.5*(-d.x+c.x)*(-b.x*b.y*d.x+a.x*b.y*d.x+b.x*b.y*c.x-a.x*b.y*c.x+a.y*b.x*d.x-a.y*a.x*d.x-a.y*b.x*c.x+a.y*a.x*c.x+2*d.y*b.x*b.x+2*d.y*a.x*a.x-4*b.x*d.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x-b.y*d.x*c.y*b.x+b.y*d.x*c.y*a.x+b.y*c.x*d.y*b.x-b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x+a.y*d.x*c.y*b.x-a.y*d.x*c.y*a.x-a.y*c.x*d.y*b.x+a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*c.x*c.x+a.y*a.y*c.x*c.x+d.y*d.y*b.x*b.x+d.y*d.y*a.x*a.x-2*b.y*c.x*c.x*a.y-2*d.y*d.y*b.x*a.x-2*a.x*b.y*b.y*c.x-2*a.y*a.y*b.x*c.x+2*b.y*a.y*b.x*c.x+2*a.y*a.x*b.y*c.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*b.y*a.x*a.x*c.y-2*a.y*b.x*b.x*c.y-2*a.y*b.x*a.x*b.y+2*b.y*b.x*c.y*a.x+2*a.y*b.x*c.y*a.x)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.x-a.x);
    return A;
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_2oo(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=-(T).5*(-d.x+c.x)*(-b.y*c.x+a.y*c.x-2*a.y*b.x+2*a.x*b.y-b.y*d.x+a.y*d.x)/(-b.x+a.x);

    dA(1).x=-(-d.x+c.x)*b.y/(-b.x+a.x)+.5*(-d.x+c.x)*(-b.y*c.x+a.y*c.x-2*a.y*b.x+2*a.x*b.y-b.y*d.x+a.y*d.x)/sqr(-b.x+a.x);
    dA(1).y=-.5*(-d.x+c.x)*(c.x-2*b.x+d.x)/(-b.x+a.x);
    dA(2).x=(-d.x+c.x)*a.y/(-b.x+a.x)-.5*(-d.x+c.x)*(-b.y*c.x+a.y*c.x-2*a.y*b.x+2*a.x*b.y-b.y*d.x+a.y*d.x)/sqr(-b.x+a.x);
    dA(2).y=-.5*(-d.x+c.x)*(-c.x+2*a.x-d.x)/(-b.x+a.x);
    dA(3).x=-.5*(-b.y*c.x+a.y*c.x-2*a.y*b.x+2*a.x*b.y-b.y*d.x+a.y*d.x)/(-b.x+a.x)-.5*(-d.x+c.x)*(-b.y+a.y)/(-b.x+a.x);
    dA(3).y=0;
    dA(4).x=.5*(-b.y*c.x+a.y*c.x-2*a.y*b.x+2*a.x*b.y-b.y*d.x+a.y*d.x)/(-b.x+a.x)-.5*(-d.x+c.x)*(-b.y+a.y)/(-b.x+a.x);
    dA(4).y=0;

    return A;
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_2uu(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=-(T).5*(d.y+c.y)*(-d.x+c.x);

    dA(1).x=0;
    dA(1).y=0;
    dA(2).x=0;
    dA(2).y=0;
    dA(3).x=-.5*c.y-.5*d.y;
    dA(3).y=.5*d.x-.5*c.x;
    dA(4).x=.5*c.y+.5*d.y;
    dA(4).y=.5*d.x-.5*c.x;
    return A;
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_2uo(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    LOG::cout<<__FUNCTION__<<std::endl;
    T yvab=(ya+yb)/2,yba=yb-ya,yvcd=(yc+yd)/2,ydc=yd-yc;
    T A=-(T).5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*d.y*b.x*b.x+2*b.y*b.x*d.y*a.x+2*a.y*b.x*b.y*d.x+2*a.y*b.x*d.y*a.x+2*a.y*a.x*b.y*d.x-2*a.y*a.y*b.x*d.x-2*a.y*b.x*a.x*b.y+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);

    dA(1).x=-.5*(-d.x+c.x)*(b.y*d.x*d.y-b.y*d.x*c.y+b.y*c.x*d.y+b.y*c.x*c.y-a.y*d.x*d.y+c.y*a.y*d.x-a.y*c.x*d.y-c.y*a.y*c.x+2*a.x*c.y*c.y-2*c.y*c.y*b.x-2*b.y*b.y*d.x+2*b.y*d.x*a.y+2*b.y*b.y*a.x-2*b.y*b.x*a.y+2*a.y*d.y*b.x+2*b.y*d.y*b.x-4*b.y*d.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/sqr(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-d.y+c.y);
    dA(1).y=-.5*(-d.x+c.x)*(d.x*d.y*b.x-d.x*d.y*a.x-c.y*b.x*d.x+c.y*a.x*d.x+c.x*d.y*b.x-c.x*d.y*a.x+c.y*b.x*c.x-c.y*a.x*c.x+2*d.x*d.x*a.y-2*b.y*d.x*d.x-4*a.y*b.x*d.x+2*b.x*b.y*d.x+2*a.x*b.y*d.x+2*a.y*b.x*b.x-2*d.y*b.x*b.x-2*a.x*b.y*b.x+2*b.x*d.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.x-c.x);
    dA(2).x=-.5*(-d.x+c.x)*(-b.y*d.x*d.y+b.y*d.x*c.y-b.y*c.x*d.y-b.y*c.x*c.y+a.y*d.x*d.y-c.y*a.y*d.x+a.y*c.x*d.y+c.y*a.y*c.x+2*c.y*c.y*b.x-2*a.x*c.y*c.y-2*a.y*a.y*d.x+2*b.y*d.x*a.y+2*a.y*a.y*b.x-4*a.y*d.y*b.x-2*b.y*a.x*a.y+2*a.y*d.y*a.x+2*b.y*d.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/sqr(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(d.y-c.y);
    dA(2).y=-.5*(-d.x+c.x)*(-d.x*d.y*b.x+d.x*d.y*a.x+c.y*b.x*d.x-c.y*a.x*d.x-c.x*d.y*b.x+c.x*d.y*a.x-c.y*b.x*c.x+c.y*a.x*c.x+2*b.y*d.x*d.x-2*d.x*d.x*a.y-4*a.x*b.y*d.x+2*a.y*b.x*d.x+2*a.y*a.x*d.x+2*a.x*a.x*b.y-2*a.y*a.x*b.x+2*b.x*d.y*a.x-2*d.y*a.x*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*sqr(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);
    dA(3).x=-.5*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(b.y*c.y*a.x-b.y*d.y*b.x+b.y*d.y*a.x-b.y*c.y*b.x-a.y*c.y*a.x+a.y*d.y*b.x-a.y*d.y*a.x+a.y*c.y*b.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.y-a.y);
    dA(3).y=-.5*(-d.x+c.x)*(b.x*b.y*d.x-a.x*b.y*d.x-b.x*b.y*c.x+a.x*b.y*c.x-a.y*b.x*d.x+a.y*a.x*d.x+a.y*b.x*c.x-a.y*a.x*c.x+2*c.y*b.x*b.x+2*c.y*a.x*a.x-4*b.x*c.y*a.x)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x);
    dA(4).x=.5*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)-.5*(-d.x+c.x)*(-b.y*d.y*b.x+b.y*d.y*a.x+b.y*c.y*b.x-b.y*c.y*a.x+a.y*d.y*b.x-a.y*d.y*a.x-a.y*c.y*b.x+a.y*c.y*a.x+2*b.y*b.y*d.x+2*a.y*a.y*d.x-4*b.y*d.x*a.y-2*b.y*b.y*a.x-2*a.y*a.y*b.x+2*b.y*b.x*a.y+2*b.y*a.x*a.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(-b.y+a.y);
    dA(4).y=-.5*(-d.x+c.x)*(-b.x*b.y*d.x+a.x*b.y*d.x-b.x*b.y*c.x+a.x*b.y*c.x+a.y*b.x*d.x-a.y*a.x*d.x+a.y*b.x*c.x-a.y*a.x*c.x-2*a.y*b.x*b.x+2*a.y*a.x*b.x+2*a.x*b.y*b.x-2*a.x*a.x*b.y)/(-b.x+a.x)/(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)+.5*(-d.x+c.x)*(-b.y*d.x*d.y*b.x+b.y*d.x*d.y*a.x+b.y*d.x*c.y*b.x-b.y*d.x*c.y*a.x-b.y*c.x*d.y*b.x+b.y*c.x*d.y*a.x-b.y*c.x*c.y*b.x+b.y*c.x*c.y*a.x+a.y*d.x*d.y*b.x-a.y*d.x*d.y*a.x-a.y*d.x*c.y*b.x+a.y*d.x*c.y*a.x+a.y*c.x*d.y*b.x-a.y*c.x*d.y*a.x+a.y*c.x*c.y*b.x-a.y*c.x*c.y*a.x+b.y*b.y*d.x*d.x+a.y*a.y*d.x*d.x+c.y*c.y*b.x*b.x+c.y*c.y*a.x*a.x-2*b.y*d.x*d.x*a.y-2*c.y*c.y*b.x*a.x-2*a.x*b.y*b.y*d.x-2*a.y*a.y*b.x*d.x+2*b.y*a.y*b.x*d.x+2*a.y*a.x*b.y*d.x+a.y*a.y*b.x*b.x+a.x*a.x*b.y*b.y-2*a.y*b.x*b.x*d.y-2*a.y*b.x*a.x*b.y+2*a.y*b.x*d.y*a.x+2*a.x*b.y*d.y*b.x-2*a.x*a.x*b.y*d.y)/(-b.x+a.x)/sqr(-b.y*d.x+b.y*c.x+a.y*d.x-a.y*c.x+d.y*b.x-d.y*a.x-c.y*b.x+c.y*a.x)*(b.x-a.x);
    return A;
}

// Case 1 order: a c b d; ou = c over, b under
template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_1(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    PHYSBAM_ASSERT(a.x<=c.x);
    PHYSBAM_ASSERT(c.x<=b.x);
    PHYSBAM_ASSERT(b.x<=d.x);
    bool co=(-a.y*b.x+a.x*b.y+c.y*b.x-c.y*a.x-b.y*c.x+a.y*c.x)>0;
    bool bo=(-d.y*b.x+c.y*b.x+b.y*d.x-b.y*c.x-c.y*d.x+c.x*d.y)>0;

    if(co){
        if(bo) return Trapezoid_Intersection_Area_Case_1oo(a,b,c,d,dA,H);
        else return Trapezoid_Intersection_Area_Case_1ou(a,b,c,d,dA,H);}
    else{
        if(bo) return Trapezoid_Intersection_Area_Case_1uo(a,b,c,d,dA,H);
        else return Trapezoid_Intersection_Area_Case_1uu(a,b,c,d,dA,H);}
}

// Case 2 order: a c d b; ou = c over, d under
template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area_Case_2(const TV& a,const TV& b,const TV& c,const TV& d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    PHYSBAM_ASSERT(a.x<=c.x);
    PHYSBAM_ASSERT(c.x<=d.x);
    PHYSBAM_ASSERT(d.x<=b.x);
    bool co=(-a.y*b.x+a.x*b.y+c.y*b.x-c.y*a.x-b.y*c.x+a.y*c.x)>0;
    bool Do=(-a.y*b.x+a.x*b.y+d.y*b.x-d.y*a.x-b.y*d.x+a.y*d.x)>0;

    if(co){
        if(Do) return Trapezoid_Intersection_Area_Case_2oo(a,b,c,d,dA,H);
        else return Trapezoid_Intersection_Area_Case_2ou(a,b,c,d,dA,H);}
    else{
        if(Do) return Trapezoid_Intersection_Area_Case_2uo(a,b,c,d,dA,H);
        else return Trapezoid_Intersection_Area_Case_2uu(a,b,c,d,dA,H);}
}

template<class T,class TV> T PhysBAM::
Trapezoid_Intersection_Area(TV a,TV b,TV c,TV d,VECTOR<TV,4>& dA,VECTOR<VECTOR<MATRIX<T,2>,4>,4>& H)
{
    VECTOR<int,4> indices(1,2,3,4);
    T sign=1,A=0;
    if(a.x>b.x){sign=-sign;exchange(a,b);exchange(indices(1),indices(2));}
    if(c.x>d.x){sign=-sign;exchange(c,d);exchange(indices(3),indices(4));}
    if(a.x>c.x){exchange(a,c);exchange(b,d);exchange(indices(1),indices(3));exchange(indices(2),indices(4));}

    VECTOR<TV,4> tdA;
    VECTOR<VECTOR<MATRIX<T,2>,4>,4> tH;

    if(b.x<c.x){dA=tdA;H=tH;return 0;}

    if(b.x<d.x) A=sign*Trapezoid_Intersection_Area_Case_1(a,b,c,d,tdA,tH); // a c b d
    else A=sign*Trapezoid_Intersection_Area_Case_2(a,b,c,d,tdA,tH); // a c d b
    for(int i=1;i<=4;i++){
        dA(indices(i))=sign*tdA(i);
        for(int j=1;j<=4;j++) H(indices(i))(indices(j))=sign*tH(i)(j);}
    return A;
}

template float Trapezoid_Intersection_Area<float,VECTOR<float,2> >(VECTOR<float,2>,VECTOR<float,2>,VECTOR<float,2>,VECTOR<float,2>,VECTOR<VECTOR<float,2>,4>&,VECTOR<VECTOR<MATRIX<float,2,2>,4>,4>&);
#ifndef COMPILE_WITHOUT_DOUBLE_SUPPORT
template double Trapezoid_Intersection_Area<double,VECTOR<double,2> >(VECTOR<double,2>,VECTOR<double,2>,VECTOR<double,2>,VECTOR<double,2>,VECTOR<VECTOR<double,2>,4>&,VECTOR<VECTOR<MATRIX<double,2,2>,4>,4>&);
#endif
